# Homework 11 — Spring Security
**Author: M. Yang**

## Question 1
> Spring Boot Annotations Review

See [Spring-Boot-Annotations.md](Spring-Boot-Annotations.md).


## Question 2
> Explain the concepts below:
> - TLS (Transport Layer Security)
> - PKI (Public Key Infrastructure)
> - Certificate
> - Signature
> - Private Key
> - Public Key

### ◆ TLS
A cryptographic protocol that **secures communication over networks** by providing confidentiality, integrity, and authenticity.
It is widely **used in HTTPS** to secure web traffic.

### ◆ PKI
A system for **managing** public-key encryption and digital **certificates**, enabling secure identity verification and encrypted communication.

#### Key Components
- **Certification Authorities (CAs):** trusted entities that issue digital certificates.
- **Digital certificates:** see [◆ Certificate](#-certificate).
- **Private and public keys:** see [◆ Private Key, ◆ Public Key](#-private-key).
- **Key management:** the processes and procedures for generating, distributing, storing, and revoking digital certificates and keys.

### ◆ Signature
A cryptographic value **generated using a private key** to verify the authenticity and integrity of data, **validated with** the corresponding **public key**.

### ◆ Private Key
A **confidential** key used to **decrypt data** encrypted with the public key or to **create digital signatures**.

### ◆ Public Key
A **shared** key used to **encrypt data** or **verify digital signatures** created with the corresponding private key.

### ◆ Certificate
An electronic document that **binds a public key to an entity’s identity** (the subject), **signed** by a trusted Certificate Authority (CA).

#### Certificate Chain

<details>
<summary>Root CA Certificate</summary>

- Contains **Root CA's public** key
- Usually **pre-installed** in clients
</details>

<details>
<summary>Intermediate CA Certificate</summary>

- **Issued** by **root CA** (or superior intermediate CA)
- **Signed** by **root CA's private** key
    - A **client** with root CA Certificate uses **root CA's public** key to **verify** the signature
- **Intermediate CA's public** key **attached by the ICA**
- Distributed to a server and **then to a client by a server**
</details>

<details>
<summary>Server Certificate</summary>

- **Issued** by **intermediate CA**
- **Signed** by **intermediate CA's private** key
    - A **client** with intermediate CA Certificate uses **intermediate CA's public** key to **verify** the signature
- **Server's public** key **attached by the server**
- Distributed to a client by server
</details>

```mermaid
flowchart TB
    I((Intermediate CA))
    IPV[Inter CA Pri-key]
    S((Server))
    SPV[Server Pri-Key]
    C((Client))
    PM["Pre-master Secrete<br>for TLS Handshake<br>between Server and Client"]
    
    subgraph Root-CA-Cert
        RPB([Root CA Pub-key])
    end
    
    subgraph Intermediate-CA-Cert
        RS>Root CA Signature]
        IPB([Inter CA Pub-key])
    end
    
    subgraph Server-Cert
        IS>Inter CA Signature]
        SPB([Server Pub-key])
    end
    
    S -. generates .-> SPV
    S -. generates .-> SPB
    SPV -- 3.decrypts --> PM
    SPB -- 3.encrypts --> PM

    C -- 1.uses --> IPB
    C -- 2.uses --> RPB
    C -- 3.uses --> SPB
    
    I -. generates .-> IPV
    I -. generates .-> IPB
    IPV -- signs --> IS
    IPB -- 1.verifies --> IS
    
    Root-CA-Cert -. Pre-installed .-> C
    RPB -- 2.verifies --> RS

    %% Styling
    classDef rcaStyle fill:#FC9090,stroke:#333,stroke-width:1.5px;
    classDef icaStyle fill:#FFD700,stroke:#333,stroke-width:1.5px;
    classDef serverStyle fill:#87CEEB,stroke:#333,stroke-width:1.5px;
    classDef clientStyle fill:#98FB98,stroke:#333,stroke-width:1.5px;
    classDef pmStyle fill:#a7f2e6,stroke:#333,stroke-width:1.5px;
    
    class RPB,RS rcaStyle;
    class I,IPV,IPB,IS icaStyle;
    class S,SPV,SPB serverStyle;
    class C clientStyle;
    class PM pmStyle;
```


## Question 3
> Create an API that supports HTTPS with a self-signed certificate.
> - Pack the certificate as a `.jks` file.
>
> **Part 1 — Testing in Postman**
> 
> Postman **doesn't** use the **system's TRUSTED** certificate store.
> Therefore, for **this part**, it doesn't matter whetter the certificate is imported into the system's trusted certificate store.
> - Test the HTTPS connection in Postman **without** importing the certificate into Postman.
>   - SSL certificate verification **must be turned on** in Postman.
> - Test the HTTPS connection in Postman after importing the certificate.
>
> **Part 2 — Testing in Browser**
> 
> Browsers use the **system's TRUSTED** certificate store.
> - Test the HTTPS connection in a browser **without** adding the certificate to the trusted certificate store.
> - Test again after adding the certificate to the **trusted** certificate store.
>   - Installing the certificate to another certificate store of the system won't work.
> For example, the system may ask whether to **automatically** select the certificate store and install to a **non-trusted** store.

### Part 1 — Testing in Postman

<details>
<summary>Results</summary>

◾ **SSL certificate verification has been turned on.**

![postman-verification](https://github.com/user-attachments/assets/adf3a089-0c44-4d97-ae6f-fa08a2fab340)

◾ **Postman reports `Error: self signed signature` without certificate imported.**

![postman-https-fail](https://github.com/user-attachments/assets/09413b15-27f7-4dd1-98b1-4ff252a6aa29)

◾ **HTTPS connection successful after certificate imported.**

![postman-certs](https://github.com/user-attachments/assets/3c2cc514-b35a-49bc-b86b-fdd4e1a31276)
![postman-https](https://github.com/user-attachments/assets/cb988d19-8fda-462c-b116-0111fff94462)

◾ **HTTP connections aren't allowed as designed.**

![postman-http](https://github.com/user-attachments/assets/468fd946-ba15-4d39-adfc-ec7f24213804)

</details>

### Part 2 — Testing in Browser

<details>
<summary>Results</summary>

◾ **Browser reports site insecure without certificate in the trusted store.**

![browser-https-insecure](https://github.com/user-attachments/assets/4e65ac5f-5f91-4266-b7b3-71ebcb3fadd5)

◾ **Browser reports no issues with certificate in the trusted store.**

![browser-https-secure](https://github.com/user-attachments/assets/95cb4e8f-2d2c-4095-8f38-a2c111382f65)

◾ **HTTP connections aren't allowed as designed.**

![browser-http](https://github.com/user-attachments/assets/79d721f3-51b4-409b-b8da-2fe834ce2385)

</details>


## Question 4
> HTTPS status codes related to authentication and authorization failures

| **Status Code** | **Name**                        | **Category**   | **Description**                                                              |
|-----------------|---------------------------------|----------------|------------------------------------------------------------------------------|
| 401             | Unauthorized                    | Authentication | The request lacks valid authentication credentials.                          |
| 403             | Forbidden                       | Authorization  | The server understands the request but refuses to authorize it.              |
| 407             | Proxy Authentication Required   | Authentication | The client must authenticate itself with a proxy server.                     |
| 511             | Network Authentication Required | Authentication | The client must authenticate to gain network access (e.g., captive portals). |


## Question 5
> Authentication vs. Authorization
> 
> Components in Spring Security Flow

| **Aspect**           | **Authentication**                       | **Authorization**             |
|----------------------|------------------------------------------|-------------------------------|
| **Purpose**          | Verifies identity                        | Grants access rights          |
| **Occurs**           | First                                    | Second (after authentication) |
| **Based on**         | Credentials (e.g., password, biometrics) | Permissions and roles         |
| **Determines**       | Who the user is                          | What the user can do          |
| **Example Question** | "Are you who you say you are?"           | "Are you allowed to do this?" |

